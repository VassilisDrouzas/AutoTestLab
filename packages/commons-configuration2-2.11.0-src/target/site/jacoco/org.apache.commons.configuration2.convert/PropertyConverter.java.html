<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="el"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PropertyConverter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Apache Commons Configuration</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.configuration2.convert</a> &gt; <span class="el_source">PropertyConverter.java</span></div><h1>PropertyConverter.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.commons.configuration2.convert;

import java.awt.Color;
import java.io.File;
import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.net.InetAddress;
import java.net.MalformedURLException;
import java.net.URI;
import java.net.URISyntaxException;
import java.net.URL;
import java.net.UnknownHostException;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.time.Duration;
import java.time.format.DateTimeParseException;
import java.util.Calendar;
import java.util.Date;
import java.util.Locale;
import java.util.regex.Pattern;
import java.util.regex.PatternSyntaxException;

import org.apache.commons.configuration2.ex.ConversionException;
import org.apache.commons.lang3.BooleanUtils;
import org.apache.commons.lang3.StringUtils;

/**
 * A utility class to convert the configuration properties into any type.
 *
 * @since 2.8.0
 */
public final class PropertyConverter {

    /** Constant for the prefix of hex numbers. */
    private static final String HEX_PREFIX = &quot;0x&quot;;

    /** Constant for the radix of hex numbers. */
    private static final int HEX_RADIX = 16;

    /** Constant for the prefix of binary numbers. */
    private static final String BIN_PREFIX = &quot;0b&quot;;

    /** Constant for the radix of binary numbers. */
    private static final int BIN_RADIX = 2;

    /** Constant for the argument classes of the Number constructor that takes a String. */
<span class="fc" id="L68">    private static final Class&lt;?&gt;[] CONSTR_ARGS = {String.class};</span>

    /** The fully qualified name of {@code javax.mail.internet.InternetAddress}, as used in the javamail-1.* API.  */
    private static final String INTERNET_ADDRESS_CLASSNAME_JAVAX = &quot;javax.mail.internet.InternetAddress&quot;;

    /** The fully qualified name of {@code jakarta.mail.internet.InternetAddress}, as used in the javamail-2.0+ API. */
    private static final String INTERNET_ADDRESS_CLASSNAME_JAKARTA = &quot;jakarta.mail.internet.InternetAddress&quot;;

    /**
     * Converts a value to a constant of an enumeration class.
     *
     * @param enumClass the enumeration class
     * @param value the value to be converted
     * @return the converted value
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    // conversion is safe because we know that the class is an Enum class
    private static Object convertToEnum(final Class&lt;?&gt; enumClass, final Object value) {
<span class="nc" id="L86">        return toEnum(value, enumClass.asSubclass(Enum.class));</span>
    }

    /**
     * Converts the specified value object to the given target data class. If additional
     * information is required for this conversion, it is obtained from the passed in {@code DefaultConversionHandler}
     * object. If the class is a primitive type (Integer.TYPE, Boolean.TYPE, etc), the value returned will use the wrapper
     * type (Integer.class, Boolean.class, etc).
     *
     * @param cls the target class of the converted value
     * @param value the value to convert
     * @param convHandler the conversion handler object
     * @return the converted value
     * @throws ConversionException if the value is not compatible with the requested type
     */
    public static Object to(final Class&lt;?&gt; cls, final Object value, final DefaultConversionHandler convHandler) throws ConversionException {
<span class="fc bfc" id="L102" title="All 2 branches covered.">        if (cls.isInstance(value)) {</span>
<span class="fc" id="L103">            return value; // no conversion needed</span>
        }

<span class="fc bfc" id="L106" title="All 2 branches covered.">        if (String.class.equals(cls)) {</span>
<span class="fc" id="L107">            return String.valueOf(value);</span>
        }
<span class="pc bpc" id="L109" title="1 of 4 branches missed.">        if (Boolean.class.equals(cls) || Boolean.TYPE.equals(cls)) {</span>
<span class="fc" id="L110">            return toBoolean(value);</span>
        }
<span class="fc bfc" id="L112" title="All 4 branches covered.">        if (Character.class.equals(cls) || Character.TYPE.equals(cls)) {</span>
<span class="fc" id="L113">            return toCharacter(value);</span>
        }
<span class="fc bfc" id="L115" title="All 4 branches covered.">        if (Number.class.isAssignableFrom(cls) || cls.isPrimitive()) {</span>
<span class="fc bfc" id="L116" title="All 4 branches covered.">            if (Integer.class.equals(cls) || Integer.TYPE.equals(cls)) {</span>
<span class="fc" id="L117">                return toInteger(value);</span>
            }
<span class="fc bfc" id="L119" title="All 4 branches covered.">            if (Long.class.equals(cls) || Long.TYPE.equals(cls)) {</span>
<span class="fc" id="L120">                return toLong(value);</span>
            }
<span class="pc bpc" id="L122" title="1 of 4 branches missed.">            if (Byte.class.equals(cls) || Byte.TYPE.equals(cls)) {</span>
<span class="fc" id="L123">                return toByte(value);</span>
            }
<span class="pc bpc" id="L125" title="1 of 4 branches missed.">            if (Short.class.equals(cls) || Short.TYPE.equals(cls)) {</span>
<span class="fc" id="L126">                return toShort(value);</span>
            }
<span class="pc bpc" id="L128" title="1 of 4 branches missed.">            if (Float.class.equals(cls) || Float.TYPE.equals(cls)) {</span>
<span class="fc" id="L129">                return toFloat(value);</span>
            }
<span class="pc bpc" id="L131" title="1 of 4 branches missed.">            if (Double.class.equals(cls) || Double.TYPE.equals(cls)) {</span>
<span class="fc" id="L132">                return toDouble(value);</span>
            }
<span class="fc bfc" id="L134" title="All 2 branches covered.">            if (BigInteger.class.equals(cls)) {</span>
<span class="fc" id="L135">                return toBigInteger(value);</span>
            }
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">            if (BigDecimal.class.equals(cls)) {</span>
<span class="fc" id="L138">                return toBigDecimal(value);</span>
            }
<span class="fc bfc" id="L140" title="All 2 branches covered.">        } else if (Date.class.equals(cls)) {</span>
<span class="fc" id="L141">            return toDate(value, convHandler.getDateFormat());</span>
<span class="fc bfc" id="L142" title="All 2 branches covered.">        } else if (Calendar.class.equals(cls)) {</span>
<span class="fc" id="L143">            return toCalendar(value, convHandler.getDateFormat());</span>
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">        } else if (File.class.equals(cls)) {</span>
<span class="nc" id="L145">            return toFile(value);</span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">        } else if (Path.class.equals(cls)) {</span>
<span class="nc" id="L147">            return toPath(value);</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">        } else if (URI.class.equals(cls)) {</span>
<span class="fc" id="L149">            return toURI(value);</span>
<span class="fc bfc" id="L150" title="All 2 branches covered.">        } else if (URL.class.equals(cls)) {</span>
<span class="fc" id="L151">            return toURL(value);</span>
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">        } else if (Pattern.class.equals(cls)) {</span>
<span class="nc" id="L153">            return toPattern(value);</span>
<span class="fc bfc" id="L154" title="All 2 branches covered.">        } else if (Locale.class.equals(cls)) {</span>
<span class="fc" id="L155">            return toLocale(value);</span>
<span class="pc bpc" id="L156" title="1 of 2 branches missed.">        } else if (cls.isEnum()) {</span>
<span class="nc" id="L157">            return convertToEnum(cls, value);</span>
<span class="fc bfc" id="L158" title="All 2 branches covered.">        } else if (Color.class.equals(cls)) {</span>
<span class="fc" id="L159">            return toColor(value);</span>
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">        } else if (cls.getName().equals(INTERNET_ADDRESS_CLASSNAME_JAVAX)) {</span>
            // javamail-1.* With javax.mail.* namespace.
<span class="nc" id="L162">            return toInternetAddress(value, INTERNET_ADDRESS_CLASSNAME_JAVAX);</span>
<span class="fc bfc" id="L163" title="All 2 branches covered.">        } else if (cls.getName().equals(INTERNET_ADDRESS_CLASSNAME_JAKARTA)) {</span>
            // javamail-2.0+, with jakarta.mail.* namespace.
<span class="fc" id="L165">            return toInternetAddress(value, INTERNET_ADDRESS_CLASSNAME_JAKARTA);</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">        } else if (InetAddress.class.isAssignableFrom(cls)) {</span>
<span class="fc" id="L167">            return toInetAddress(value);</span>
<span class="pc bpc" id="L168" title="1 of 2 branches missed.">        } else if (Duration.class.equals(cls)) {</span>
<span class="fc" id="L169">            return toDuration(value);</span>
        }

<span class="nc" id="L172">        throw new ConversionException(&quot;The value '&quot; + value + &quot;' (&quot; + value.getClass() + &quot;)&quot; + &quot; can't be converted to a &quot; + cls.getName() + &quot; object&quot;);</span>
    }

    /**
     * Converts the specified object into a BigDecimal.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a BigDecimal
     */
    public static BigDecimal toBigDecimal(final Object value) throws ConversionException {
<span class="fc" id="L183">        final Number n = toNumber(value, BigDecimal.class);</span>
<span class="fc bfc" id="L184" title="All 2 branches covered.">        if (n instanceof BigDecimal) {</span>
<span class="fc" id="L185">            return (BigDecimal) n;</span>
        }
<span class="fc" id="L187">        return BigDecimal.valueOf(n.doubleValue());</span>
    }

    /**
     * Converts the specified object into a BigInteger.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a BigInteger
     */
    public static BigInteger toBigInteger(final Object value) throws ConversionException {
<span class="fc" id="L198">        final Number n = toNumber(value, BigInteger.class);</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">        if (n instanceof BigInteger) {</span>
<span class="fc" id="L200">            return (BigInteger) n;</span>
        }
<span class="fc" id="L202">        return BigInteger.valueOf(n.longValue());</span>
    }

    /**
     * Converts the specified object into a Boolean. Internally the {@code org.apache.commons.lang.BooleanUtils} class from
     * the &lt;a href=&quot;https://commons.apache.org/lang/&quot;&gt;Commons Lang&lt;/a&gt; project is used to perform this conversion. This
     * class accepts some more tokens for the boolean value of &lt;b&gt;true&lt;/b&gt;, e.g. {@code yes} and {@code on}. Please refer to
     * the documentation of this class for more details.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a boolean
     */
    public static Boolean toBoolean(final Object value) throws ConversionException {
<span class="pc bpc" id="L216" title="1 of 2 branches missed.">        if (value instanceof Boolean) {</span>
<span class="nc" id="L217">            return (Boolean) value;</span>
        }
<span class="fc bfc" id="L219" title="All 2 branches covered.">        if (!(value instanceof String)) {</span>
<span class="fc" id="L220">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Boolean object&quot;);</span>
        }
<span class="fc" id="L222">        final Boolean b = BooleanUtils.toBooleanObject((String) value);</span>
<span class="fc bfc" id="L223" title="All 2 branches covered.">        if (b == null) {</span>
<span class="fc" id="L224">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Boolean object&quot;);</span>
        }
<span class="fc" id="L226">        return b;</span>
    }

    /**
     * Converts the specified object into a Byte.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a byte
     */
    public static Byte toByte(final Object value) throws ConversionException {
<span class="fc" id="L237">        final Number n = toNumber(value, Byte.class);</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">        if (n instanceof Byte) {</span>
<span class="fc" id="L239">            return (Byte) n;</span>
        }
<span class="fc" id="L241">        return n.byteValue();</span>
    }

    /**
     * Converts the specified object into a Calendar.
     *
     * @param value the value to convert
     * @param format the DateFormat pattern to parse String values
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Calendar
     */
    public static Calendar toCalendar(final Object value, final String format) throws ConversionException {
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">        if (value instanceof Calendar) {</span>
<span class="nc" id="L254">            return (Calendar) value;</span>
        }
<span class="fc bfc" id="L256" title="All 2 branches covered.">        if (value instanceof Date) {</span>
<span class="fc" id="L257">            final Calendar calendar = Calendar.getInstance();</span>
<span class="fc" id="L258">            calendar.setTime((Date) value);</span>
<span class="fc" id="L259">            return calendar;</span>
        }
<span class="fc bfc" id="L261" title="All 2 branches covered.">        if (!(value instanceof String)) {</span>
<span class="fc" id="L262">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Calendar&quot;);</span>
        }
        try {
<span class="fc" id="L265">            final Calendar calendar = Calendar.getInstance();</span>
<span class="fc" id="L266">            calendar.setTime(new SimpleDateFormat(format).parse((String) value));</span>
<span class="fc" id="L267">            return calendar;</span>
<span class="fc" id="L268">        } catch (final ParseException e) {</span>
<span class="fc" id="L269">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Calendar&quot;, e);</span>
        }
    }

    /**
     * Converts the specified value object to a {@code Character}. This method converts the passed in object to a string. If
     * the string has exactly one character, this character is returned as result. Otherwise, conversion fails.
     *
     * @param value the value to be converted
     * @return the resulting {@code Character} object
     * @throws ConversionException if the conversion is not possible
     */
    public static Character toCharacter(final Object value) throws ConversionException {
<span class="fc" id="L282">        final String strValue = String.valueOf(value);</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">        if (strValue.length() == 1) {</span>
<span class="fc" id="L284">            return Character.valueOf(strValue.charAt(0));</span>
        }
<span class="fc" id="L286">        throw new ConversionException(String.format(&quot;The value '%s' cannot be converted to a Character object!&quot;, strValue));</span>
    }

    /**
     * Converts the specified object into a Color. If the value is a String, the format allowed is
     * (#)?[0-9A-F]{6}([0-9A-F]{2})?. Examples:
     * &lt;ul&gt;
     * &lt;li&gt;FF0000 (red)&lt;/li&gt;
     * &lt;li&gt;0000FFA0 (semi transparent blue)&lt;/li&gt;
     * &lt;li&gt;#CCCCCC (gray)&lt;/li&gt;
     * &lt;li&gt;#00FF00A0 (semi transparent green)&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Color
     */
    public static Color toColor(final Object value) throws ConversionException {
<span class="pc bpc" id="L304" title="1 of 2 branches missed.">        if (value instanceof Color) {</span>
<span class="nc" id="L305">            return (Color) value;</span>
        }
<span class="pc bpc" id="L307" title="1 of 4 branches missed.">        if (!(value instanceof String) || StringUtils.isBlank((String) value)) {</span>
<span class="fc" id="L308">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Color&quot;);</span>
        }
<span class="fc" id="L310">        String color = ((String) value).trim();</span>

<span class="fc" id="L312">        final int[] components = new int[3];</span>

        // check the size of the string
<span class="fc" id="L315">        final int minlength = components.length * 2;</span>
<span class="pc bpc" id="L316" title="1 of 2 branches missed.">        if (color.length() &lt; minlength) {</span>
<span class="nc" id="L317">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Color&quot;);</span>
        }

        // remove the leading #
<span class="fc bfc" id="L321" title="All 2 branches covered.">        if (color.startsWith(&quot;#&quot;)) {</span>
<span class="fc" id="L322">            color = color.substring(1);</span>
        }

        try {
            // parse the components
<span class="fc bfc" id="L327" title="All 2 branches covered.">            for (int i = 0; i &lt; components.length; i++) {</span>
<span class="fc" id="L328">                components[i] = Integer.parseInt(color.substring(2 * i, 2 * i + 2), HEX_RADIX);</span>
            }

            // parse the transparency
            final int alpha;
<span class="fc bfc" id="L333" title="All 2 branches covered.">            if (color.length() &gt;= minlength + 2) {</span>
<span class="fc" id="L334">                alpha = Integer.parseInt(color.substring(minlength, minlength + 2), HEX_RADIX);</span>
            } else {
<span class="fc" id="L336">                alpha = Color.black.getAlpha();</span>
            }

<span class="fc" id="L339">            return new Color(components[0], components[1], components[2], alpha);</span>
<span class="fc" id="L340">        } catch (final Exception e) {</span>
<span class="fc" id="L341">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Color&quot;, e);</span>
        }
    }

    /**
     * Converts the specified object into a Date.
     *
     * @param value the value to convert
     * @param format the DateFormat pattern to parse String values
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Calendar
     */
    public static Date toDate(final Object value, final String format) throws ConversionException {
<span class="pc bpc" id="L354" title="1 of 2 branches missed.">        if (value instanceof Date) {</span>
<span class="nc" id="L355">            return (Date) value;</span>
        }
<span class="fc bfc" id="L357" title="All 2 branches covered.">        if (value instanceof Calendar) {</span>
<span class="fc" id="L358">            return ((Calendar) value).getTime();</span>
        }
<span class="fc bfc" id="L360" title="All 2 branches covered.">        if (!(value instanceof String)) {</span>
<span class="fc" id="L361">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Date&quot;);</span>
        }
        try {
<span class="fc" id="L364">            return new SimpleDateFormat(format).parse((String) value);</span>
<span class="fc" id="L365">        } catch (final ParseException e) {</span>
<span class="fc" id="L366">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Date&quot;, e);</span>
        }
    }

    /**
     * Converts the specified object into a Double.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Double
     */
    public static Double toDouble(final Object value) throws ConversionException {
<span class="fc" id="L378">        final Number n = toNumber(value, Double.class);</span>
<span class="fc bfc" id="L379" title="All 2 branches covered.">        if (n instanceof Double) {</span>
<span class="fc" id="L380">            return (Double) n;</span>
        }
<span class="fc" id="L382">        return Double.valueOf(n.doubleValue());</span>
    }

    /**
     * Converts the specified object into a Duration.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Duration
     * @since 2.8.0
     */
    public static Duration toDuration(final Object value) throws ConversionException {
<span class="pc bpc" id="L394" title="1 of 2 branches missed.">        if (value instanceof Duration) {</span>
<span class="nc" id="L395">            return (Duration) value;</span>
        }
<span class="pc bpc" id="L397" title="1 of 2 branches missed.">        if (value instanceof CharSequence) {</span>
            try {
<span class="fc" id="L399">                return Duration.parse((CharSequence) value);</span>
<span class="fc" id="L400">            } catch (final DateTimeParseException e) {</span>
<span class="fc" id="L401">                throw new ConversionException(&quot;Could not convert &quot; + value + &quot; to Duration&quot;, e);</span>
            }
        }
<span class="nc" id="L404">        throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Duration&quot;);</span>
    }

    /**
     * Converts the specified value into an {@link Enum}.
     *
     * @param value the value to convert
     * @param cls the type of the enumeration
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to an enumeration
     *
     * @since 1.5
     */
    static &lt;E extends Enum&lt;E&gt;&gt; E toEnum(final Object value, final Class&lt;E&gt; cls) throws ConversionException {
<span class="fc bfc" id="L418" title="All 2 branches covered.">        if (value.getClass().equals(cls)) {</span>
<span class="fc" id="L419">            return cls.cast(value);</span>
        }
<span class="fc bfc" id="L421" title="All 2 branches covered.">        if (value instanceof String) {</span>
            try {
<span class="fc" id="L423">                return Enum.valueOf(cls, (String) value);</span>
<span class="fc" id="L424">            } catch (final Exception e) {</span>
<span class="fc" id="L425">                throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a &quot; + cls.getName());</span>
            }
        }
<span class="pc bpc" id="L428" title="1 of 2 branches missed.">        if (!(value instanceof Number)) {</span>
<span class="nc" id="L429">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a &quot; + cls.getName());</span>
        }
        try {
<span class="fc" id="L432">            final E[] enumConstants = cls.getEnumConstants();</span>
<span class="fc" id="L433">            return enumConstants[((Number) value).intValue()];</span>
<span class="fc" id="L434">        } catch (final Exception e) {</span>
<span class="fc" id="L435">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a &quot; + cls.getName());</span>
        }
    }

    /**
     * Converts the specified object into a File.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a File
     * @since 2.3
     */
    public static File toFile(final Object value) throws ConversionException {
<span class="fc bfc" id="L448" title="All 2 branches covered.">        if (value instanceof File) {</span>
<span class="fc" id="L449">            return (File) value;</span>
        }
<span class="fc bfc" id="L451" title="All 2 branches covered.">        if (value instanceof Path) {</span>
<span class="fc" id="L452">            return ((Path) value).toFile();</span>
        }
<span class="pc bpc" id="L454" title="1 of 2 branches missed.">        if (value instanceof String) {</span>
<span class="fc" id="L455">            return new File((String) value);</span>
        }
<span class="nc" id="L457">        throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a File&quot;);</span>
    }

    /**
     * Converts the specified object into a Float.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Float
     */
    public static Float toFloat(final Object value) throws ConversionException {
<span class="fc" id="L468">        final Number n = toNumber(value, Float.class);</span>
<span class="fc bfc" id="L469" title="All 2 branches covered.">        if (n instanceof Float) {</span>
<span class="fc" id="L470">            return (Float) n;</span>
        }
<span class="fc" id="L472">        return Float.valueOf(n.floatValue());</span>
    }

    /**
     * Converts the specified value into an internet address.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a InetAddress
     *
     * @since 1.5
     */
    static InetAddress toInetAddress(final Object value) throws ConversionException {
<span class="pc bpc" id="L485" title="1 of 2 branches missed.">        if (value instanceof InetAddress) {</span>
<span class="nc" id="L486">            return (InetAddress) value;</span>
        }
<span class="fc bfc" id="L488" title="All 2 branches covered.">        if (!(value instanceof String)) {</span>
<span class="fc" id="L489">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a InetAddress&quot;);</span>
        }
        try {
<span class="fc" id="L492">            return InetAddress.getByName((String) value);</span>
<span class="fc" id="L493">        } catch (final UnknownHostException e) {</span>
<span class="fc" id="L494">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a InetAddress&quot;, e);</span>
        }
    }

    /**
     * Converts the specified object into an Integer.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to an integer
     */
    public static Integer toInteger(final Object value) throws ConversionException {
<span class="fc" id="L506">        final Number n = toNumber(value, Integer.class);</span>
<span class="fc bfc" id="L507" title="All 2 branches covered.">        if (n instanceof Integer) {</span>
<span class="fc" id="L508">            return (Integer) n;</span>
        }
<span class="fc" id="L510">        return n.intValue();</span>
    }

    /**
     * Converts the specified value into an email address with the given class name.
     *
     * @param value the value to convert
     * @param targetClassName the fully qualified name of the {@code InternetAddress} class to convert to, e.g.,
     *      {@value #INTERNET_ADDRESS_CLASSNAME_JAVAX} or {@value #INTERNET_ADDRESS_CLASSNAME_JAKARTA}
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to an email address
     *
     * @since 1.5
     */
    static Object toInternetAddress(final Object value, final String targetClassName) throws ConversionException {
<span class="pc bpc" id="L525" title="1 of 2 branches missed.">        if (value.getClass().getName().equals(targetClassName)) {</span>
<span class="nc" id="L526">            return value;</span>
        }
<span class="fc bfc" id="L528" title="All 2 branches covered.">        if (!(value instanceof String)) {</span>
<span class="fc" id="L529">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to an InternetAddress&quot;);</span>
        }
        try {
<span class="fc" id="L532">            final Constructor&lt;?&gt; ctor = Class.forName(targetClassName).getConstructor(String.class);</span>
<span class="fc" id="L533">            return ctor.newInstance(value);</span>
<span class="fc" id="L534">        } catch (final Exception e) {</span>
<span class="fc" id="L535">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to an InternetAddress&quot;, e);</span>
        }
    }

    /**
     * Converts the specified object into a Locale.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Locale
     */
    public static Locale toLocale(final Object value) throws ConversionException {
<span class="pc bpc" id="L547" title="1 of 2 branches missed.">        if (value instanceof Locale) {</span>
<span class="nc" id="L548">            return (Locale) value;</span>
        }
<span class="fc bfc" id="L550" title="All 2 branches covered.">        if (!(value instanceof String)) {</span>
<span class="fc" id="L551">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Locale&quot;);</span>
        }
<span class="fc" id="L553">        final String[] elements = ((String) value).split(&quot;_&quot;);</span>
<span class="fc" id="L554">        final int size = elements.length;</span>

<span class="pc bpc" id="L556" title="1 of 6 branches missed.">        if (size &gt;= 1 &amp;&amp; (elements[0].length() == 2 || elements[0].isEmpty())) {</span>
<span class="fc" id="L557">            final String language = elements[0];</span>
<span class="fc bfc" id="L558" title="All 2 branches covered.">            final String country = size &gt;= 2 ? elements[1] : &quot;&quot;;</span>
<span class="fc bfc" id="L559" title="All 2 branches covered.">            final String variant = size &gt;= 3 ? elements[2] : &quot;&quot;;</span>

<span class="fc" id="L561">            return new Locale(language, country, variant);</span>
        }
<span class="fc" id="L563">        throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Locale&quot;);</span>
    }

    /**
     * Converts the specified object into a Long.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Long
     */
    public static Long toLong(final Object value) throws ConversionException {
<span class="fc" id="L574">        final Number n = toNumber(value, Long.class);</span>
<span class="fc bfc" id="L575" title="All 2 branches covered.">        if (n instanceof Long) {</span>
<span class="fc" id="L576">            return (Long) n;</span>
        }
<span class="fc" id="L578">        return n.longValue();</span>
    }

    /**
     * Tries to convert the specified object into a number object. This method is used by the conversion methods for number
     * types. Note that the return value is not in always of the specified target class, but only if a new object has to be
     * created.
     *
     * @param value the value to be converted (must not be &lt;b&gt;null&lt;/b&gt;)
     * @param targetClass the target class of the conversion (must be derived from {@link Number})
     * @return the converted number
     * @throws ConversionException if the object cannot be converted
     */
    static Number toNumber(final Object value, final Class&lt;?&gt; targetClass) throws ConversionException {
<span class="fc bfc" id="L592" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L593">            return (Number) value;</span>
        }
<span class="fc" id="L595">        final String str = value.toString();</span>
<span class="fc bfc" id="L596" title="All 2 branches covered.">        if (str.startsWith(HEX_PREFIX)) {</span>
            try {
<span class="fc" id="L598">                return new BigInteger(str.substring(HEX_PREFIX.length()), HEX_RADIX);</span>
<span class="fc" id="L599">            } catch (final NumberFormatException nex) {</span>
<span class="fc" id="L600">                throw new ConversionException(&quot;Could not convert &quot; + str + &quot; to &quot; + targetClass.getName() + &quot;! Invalid hex number.&quot;, nex);</span>
            }
        }

<span class="fc bfc" id="L604" title="All 2 branches covered.">        if (str.startsWith(BIN_PREFIX)) {</span>
            try {
<span class="fc" id="L606">                return new BigInteger(str.substring(BIN_PREFIX.length()), BIN_RADIX);</span>
<span class="fc" id="L607">            } catch (final NumberFormatException nex) {</span>
<span class="fc" id="L608">                throw new ConversionException(&quot;Could not convert &quot; + str + &quot; to &quot; + targetClass.getName() + &quot;! Invalid binary number.&quot;, nex);</span>
            }
        }

        try {
<span class="fc" id="L613">            final Constructor&lt;?&gt; constr = targetClass.getConstructor(CONSTR_ARGS);</span>
<span class="fc" id="L614">            return (Number) constr.newInstance(str);</span>
<span class="fc" id="L615">        } catch (final InvocationTargetException itex) {</span>
<span class="fc" id="L616">            throw new ConversionException(&quot;Could not convert &quot; + str + &quot; to &quot; + targetClass.getName(), itex.getTargetException());</span>
<span class="fc" id="L617">        } catch (final Exception ex) {</span>
            // Treat all possible exceptions the same way
<span class="fc" id="L619">            throw new ConversionException(&quot;Conversion error when trying to convert &quot; + str + &quot; to &quot; + targetClass.getName(), ex);</span>
        }
    }

    /**
     * Converts the specified object into a Path.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Path
     * @since 2.3
     */
    public static Path toPath(final Object value) throws ConversionException {
<span class="fc bfc" id="L632" title="All 2 branches covered.">        if (value instanceof File) {</span>
<span class="fc" id="L633">            return ((File) value).toPath();</span>
        }
<span class="fc bfc" id="L635" title="All 2 branches covered.">        if (value instanceof Path) {</span>
<span class="fc" id="L636">            return (Path) value;</span>
        }
<span class="pc bpc" id="L638" title="1 of 2 branches missed.">        if (value instanceof String) {</span>
<span class="fc" id="L639">            return Paths.get((String) value);</span>
        }
<span class="nc" id="L641">        throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Path&quot;);</span>
    }

    /**
     * Converts the specified object into a Pattern.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a Pattern
     */
    public static Pattern toPattern(final Object value) throws ConversionException {
<span class="fc bfc" id="L652" title="All 2 branches covered.">        if (value instanceof Pattern) {</span>
<span class="fc" id="L653">            return (Pattern) value;</span>
        }
<span class="pc bpc" id="L655" title="1 of 2 branches missed.">        if (!(value instanceof String)) {</span>
<span class="nc" id="L656">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Pattern&quot;);</span>
        }
        try {
<span class="fc" id="L659">            return Pattern.compile((String) value);</span>
<span class="nc" id="L660">        } catch (final PatternSyntaxException e) {</span>
<span class="nc" id="L661">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to a Pattern&quot;, e);</span>
        }
    }

    /**
     * Converts the specified object into a Short.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to a short
     */
    public static Short toShort(final Object value) throws ConversionException {
<span class="fc" id="L673">        final Number n = toNumber(value, Short.class);</span>
<span class="fc bfc" id="L674" title="All 2 branches covered.">        if (n instanceof Short) {</span>
<span class="fc" id="L675">            return (Short) n;</span>
        }
<span class="fc" id="L677">        return n.shortValue();</span>
    }

    /**
     * Converts the specified object into an URI.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to an URI
     */
    public static URI toURI(final Object value) throws ConversionException {
<span class="pc bpc" id="L688" title="1 of 2 branches missed.">        if (value instanceof URI) {</span>
<span class="nc" id="L689">            return (URI) value;</span>
        }
<span class="pc bpc" id="L691" title="1 of 2 branches missed.">        if (!(value instanceof String)) {</span>
<span class="nc" id="L692">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to an URI&quot;);</span>
        }
        try {
<span class="fc" id="L695">            return new URI((String) value);</span>
<span class="nc" id="L696">        } catch (final URISyntaxException e) {</span>
<span class="nc" id="L697">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to an URI&quot;, e);</span>
        }
    }

    /**
     * Converts the specified object into an URL.
     *
     * @param value the value to convert
     * @return the converted value
     * @throws ConversionException thrown if the value cannot be converted to an URL
     */
    public static URL toURL(final Object value) throws ConversionException {
<span class="pc bpc" id="L709" title="1 of 2 branches missed.">        if (value instanceof URL) {</span>
<span class="nc" id="L710">            return (URL) value;</span>
        }
<span class="fc bfc" id="L712" title="All 2 branches covered.">        if (!(value instanceof String)) {</span>
<span class="fc" id="L713">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to an URL&quot;);</span>
        }
        try {
<span class="fc" id="L716">            return new URL((String) value);</span>
<span class="fc" id="L717">        } catch (final MalformedURLException e) {</span>
<span class="fc" id="L718">            throw new ConversionException(&quot;The value &quot; + value + &quot; can't be converted to an URL&quot;, e);</span>
        }
    }

    /**
     * Private constructor prevents instances from being created.
     */
    private PropertyConverter() {
        // presvents instantiation.
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>