<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="el"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PStmtKey.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Apache Commons DBCP</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.dbcp2</a> &gt; <span class="el_source">PStmtKey.java</span></div><h1>PStmtKey.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.dbcp2;

import java.sql.Connection;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Arrays;
import java.util.Objects;
import java.util.function.Function;

import org.apache.commons.dbcp2.PoolingConnection.StatementType;

/**
 * A key uniquely identifying {@link java.sql.PreparedStatement PreparedStatement}s.
 *
 * @since 2.0
 */
public class PStmtKey {

    /**
     * Interface for Prepared or Callable Statement.
     */
    @FunctionalInterface
    private interface StatementBuilder {
        Statement createStatement(Connection connection, PStmtKey key) throws SQLException;
    }

<span class="fc" id="L43">    private static final StatementBuilder CallConcurrency = (c, k) -&gt; c.prepareCall(k.sql, k.resultSetType, k.resultSetConcurrency);</span>
<span class="fc" id="L44">    private static final StatementBuilder CallHoldability = (c, k) -&gt; c.prepareCall(k.sql, k.resultSetType, k.resultSetConcurrency, k.resultSetHoldability);</span>
<span class="fc" id="L45">    private static final StatementBuilder CallSQL = (c, k) -&gt; c.prepareCall(k.sql);</span>
<span class="fc" id="L46">    private static final StatementBuilder StatementAutoGeneratedKeys = (c, k) -&gt; c.prepareStatement(k.sql, k.autoGeneratedKeys);</span>
<span class="fc" id="L47">    private static final StatementBuilder StatementColumnIndexes = (c, k) -&gt; c.prepareStatement(k.sql, k.columnIndexes);</span>
<span class="fc" id="L48">    private static final StatementBuilder StatementColumnNames = (c, k) -&gt; c.prepareStatement(k.sql, k.columnNames);</span>
<span class="fc" id="L49">    private static final StatementBuilder StatementConcurrency = (c, k) -&gt; c.prepareStatement(k.sql, k.resultSetType, k.resultSetConcurrency);</span>
<span class="fc" id="L50">    private static final StatementBuilder StatementHoldability = (c, k) -&gt; c.prepareStatement(k.sql, k.resultSetType, k.resultSetConcurrency,</span>
<span class="fc" id="L51">        k.resultSetHoldability);</span>
<span class="fc" id="L52">    private static final StatementBuilder StatementSQL = (c, k) -&gt; c.prepareStatement(k.sql);</span>

    private static StatementBuilder match(final StatementType statementType, final StatementBuilder prep, final StatementBuilder call) {
<span class="pc bpc" id="L55" title="1 of 3 branches missed.">        switch (Objects.requireNonNull(statementType, &quot;statementType&quot;)) {</span>
        case PREPARED_STATEMENT:
<span class="fc" id="L57">            return prep;</span>
        case CALLABLE_STATEMENT:
<span class="fc" id="L59">            return call;</span>
        default:
<span class="nc" id="L61">            throw new IllegalArgumentException(statementType.toString());</span>
        }
    }

    /**
     * SQL defining Prepared or Callable Statement
     */
    private final String sql;

    /**
     * Result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY}, {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or
     * {@code ResultSet.TYPE_SCROLL_SENSITIVE}.
     */
    private final Integer resultSetType;

    /**
     * Result set concurrency. A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     * {@code ResultSet.CONCUR_UPDATABLE}.
     */
    private final Integer resultSetConcurrency;

    /**
     * Result set holdability. One of the following {@code ResultSet} constants: {@code ResultSet.HOLD_CURSORS_OVER_COMMIT}
     * or {@code ResultSet.CLOSE_CURSORS_AT_COMMIT}.
     */
    private final Integer resultSetHoldability;

    /**
     * Database catalog.
     */
    private final String catalog;

    /**
     * Database schema.
     */
    private final String schema;

    /**
     * A flag indicating whether auto-generated keys should be returned; one of {@code Statement.RETURN_GENERATED_KEYS} or
     * {@code Statement.NO_GENERATED_KEYS}.
     */
    private final Integer autoGeneratedKeys;

    /**
     * An array of column indexes indicating the columns that should be returned from the inserted row or rows.
     */
    private final int[] columnIndexes;

    /**
     * An array of column names indicating the columns that should be returned from the inserted row or rows.
     */
    private final String[] columnNames;

    /**
     * Statement builder.
     */
    private final transient StatementBuilder statementBuilder;

    /**
     * Statement type, prepared or callable.
     */
    private final StatementType statementType;

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @deprecated Use {@link #PStmtKey(String, String, String)}.
     */
    @Deprecated
    public PStmtKey(final String sql) {
<span class="nc" id="L132">        this(sql, null, StatementType.PREPARED_STATEMENT);</span>
<span class="nc" id="L133">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param resultSetType A result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY},
     *        {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or {@code ResultSet.TYPE_SCROLL_SENSITIVE}.
     * @param resultSetConcurrency A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     *        {@code ResultSet.CONCUR_UPDATABLE}.
     * @deprecated Use {@link #PStmtKey(String, String, String, int, int)}.
     */
    @Deprecated
    public PStmtKey(final String sql, final int resultSetType, final int resultSetConcurrency) {
<span class="nc" id="L147">        this(sql, null, resultSetType, resultSetConcurrency, StatementType.PREPARED_STATEMENT);</span>
<span class="nc" id="L148">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @deprecated Use {@link #PStmtKey(String, String, String)}.
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog) {
<span class="nc" id="L159">        this(sql, catalog, StatementType.PREPARED_STATEMENT);</span>
<span class="nc" id="L160">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param autoGeneratedKeys A flag indicating whether auto-generated keys should be returned; one of
     *        {@code Statement.RETURN_GENERATED_KEYS} or {@code Statement.NO_GENERATED_KEYS}.
     * @deprecated Use {@link #PStmtKey(String, String, String, int)}.
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog, final int autoGeneratedKeys) {
<span class="nc" id="L173">        this(sql, catalog, StatementType.PREPARED_STATEMENT, autoGeneratedKeys);</span>
<span class="nc" id="L174">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param resultSetType A result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY},
     *        {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or {@code ResultSet.TYPE_SCROLL_SENSITIVE}.
     * @param resultSetConcurrency A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     *        {@code ResultSet.CONCUR_UPDATABLE}.
     * @deprecated Use {@link #PStmtKey(String, String, String, int, int)}.
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog, final int resultSetType, final int resultSetConcurrency) {
<span class="nc" id="L189">        this(sql, catalog, resultSetType, resultSetConcurrency, StatementType.PREPARED_STATEMENT);</span>
<span class="nc" id="L190">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param resultSetType a result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY},
     *        {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or {@code ResultSet.TYPE_SCROLL_SENSITIVE}.
     * @param resultSetConcurrency A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     *        {@code ResultSet.CONCUR_UPDATABLE}
     * @param resultSetHoldability One of the following {@code ResultSet} constants:
     *        {@code ResultSet.HOLD_CURSORS_OVER_COMMIT} or {@code ResultSet.CLOSE_CURSORS_AT_COMMIT}.
     * @deprecated Use {@link #PStmtKey(String, String, String, int, int, int)}.
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog, final int resultSetType, final int resultSetConcurrency, final int resultSetHoldability) {
<span class="nc" id="L207">        this(sql, catalog, resultSetType, resultSetConcurrency, resultSetHoldability, StatementType.PREPARED_STATEMENT);</span>
<span class="nc" id="L208">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param resultSetType a result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY},
     *        {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or {@code ResultSet.TYPE_SCROLL_SENSITIVE}
     * @param resultSetConcurrency A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     *        {@code ResultSet.CONCUR_UPDATABLE}.
     * @param resultSetHoldability One of the following {@code ResultSet} constants:
     *        {@code ResultSet.HOLD_CURSORS_OVER_COMMIT} or {@code ResultSet.CLOSE_CURSORS_AT_COMMIT}.
     * @param statementType The SQL statement type, prepared or callable.
     * @deprecated Use {@link #PStmtKey(String, String, String, int, int, int, PoolingConnection.StatementType)}
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog, final int resultSetType, final int resultSetConcurrency, final int resultSetHoldability,
        final StatementType statementType) {
<span class="nc" id="L227">        this(sql, catalog, null, resultSetType, resultSetConcurrency, resultSetHoldability, null, null, null, statementType,</span>
<span class="nc" id="L228">            k -&gt; match(statementType, StatementHoldability, CallHoldability));</span>
<span class="nc" id="L229">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param resultSetType A result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY},
     *        {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or {@code ResultSet.TYPE_SCROLL_SENSITIVE}.
     * @param resultSetConcurrency A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     *        {@code ResultSet.CONCUR_UPDATABLE}.
     * @param statementType The SQL statement type, prepared or callable.
     * @deprecated Use {@link #PStmtKey(String, String, String, int, int, PoolingConnection.StatementType)}.
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog, final int resultSetType, final int resultSetConcurrency, final StatementType statementType) {
<span class="nc" id="L245">        this(sql, catalog, null, resultSetType, resultSetConcurrency, null, null, null, null, statementType,</span>
<span class="nc" id="L246">            k -&gt; match(statementType, StatementConcurrency, CallConcurrency));</span>
<span class="nc" id="L247">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param columnIndexes An array of column indexes indicating the columns that should be returned from the inserted row
     *        or rows.
     * @deprecated Use {@link #PStmtKey(String, String, String, int[])}.
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog, final int[] columnIndexes) {
<span class="nc" id="L260">        this(sql, catalog, null, null, null, null, null, columnIndexes, null, StatementType.PREPARED_STATEMENT, StatementColumnIndexes);</span>
<span class="nc" id="L261">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param statementType The SQL statement type, prepared or callable.
     * @deprecated Use {@link #PStmtKey(String, String, String, PoolingConnection.StatementType)}.
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog, final StatementType statementType) {
<span class="nc" id="L273">        this(sql, catalog, null, null, null, null, null, null, null, statementType, k -&gt; match(statementType, StatementSQL, CallSQL));</span>
<span class="nc" id="L274">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param statementType The SQL statement type, prepared or callable.
     * @param autoGeneratedKeys A flag indicating whether auto-generated keys should be returned; one of
     *        {@code Statement.RETURN_GENERATED_KEYS} or {@code Statement.NO_GENERATED_KEYS}.
     * @deprecated Use {@link #PStmtKey(String, String, String, PoolingConnection.StatementType, Integer)}
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog, final StatementType statementType, final Integer autoGeneratedKeys) {
<span class="nc" id="L288">        this(sql, catalog, null, null, null, null, autoGeneratedKeys, null, null, statementType,</span>
<span class="nc" id="L289">            k -&gt; match(statementType, StatementAutoGeneratedKeys, CallSQL));</span>
<span class="nc" id="L290">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema
     * @since 2.5.0
     */
    public PStmtKey(final String sql, final String catalog, final String schema) {
<span class="fc" id="L301">        this(sql, catalog, schema, StatementType.PREPARED_STATEMENT);</span>
<span class="fc" id="L302">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema
     * @param autoGeneratedKeys A flag indicating whether auto-generated keys should be returned; one of
     *        {@code Statement.RETURN_GENERATED_KEYS} or {@code Statement.NO_GENERATED_KEYS}.
     * @since 2.5.0
     */
    public PStmtKey(final String sql, final String catalog, final String schema, final int autoGeneratedKeys) {
<span class="fc" id="L315">        this(sql, catalog, schema, StatementType.PREPARED_STATEMENT, autoGeneratedKeys);</span>
<span class="fc" id="L316">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema
     * @param resultSetType A result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY},
     *        {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or {@code ResultSet.TYPE_SCROLL_SENSITIVE}.
     * @param resultSetConcurrency A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     *        {@code ResultSet.CONCUR_UPDATABLE}.
     */
    public PStmtKey(final String sql, final String catalog, final String schema, final int resultSetType, final int resultSetConcurrency) {
<span class="fc" id="L330">        this(sql, catalog, schema, resultSetType, resultSetConcurrency, StatementType.PREPARED_STATEMENT);</span>
<span class="fc" id="L331">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema
     * @param resultSetType a result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY},
     *        {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or {@code ResultSet.TYPE_SCROLL_SENSITIVE}.
     * @param resultSetConcurrency A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     *        {@code ResultSet.CONCUR_UPDATABLE}
     * @param resultSetHoldability One of the following {@code ResultSet} constants:
     *        {@code ResultSet.HOLD_CURSORS_OVER_COMMIT} or {@code ResultSet.CLOSE_CURSORS_AT_COMMIT}.
     * @since 2.5.0
     */
    public PStmtKey(final String sql, final String catalog, final String schema, final int resultSetType, final int resultSetConcurrency,
        final int resultSetHoldability) {
<span class="fc" id="L349">        this(sql, catalog, schema, resultSetType, resultSetConcurrency, resultSetHoldability, StatementType.PREPARED_STATEMENT);</span>
<span class="fc" id="L350">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema.
     * @param resultSetType a result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY},
     *        {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or {@code ResultSet.TYPE_SCROLL_SENSITIVE}
     * @param resultSetConcurrency A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     *        {@code ResultSet.CONCUR_UPDATABLE}.
     * @param resultSetHoldability One of the following {@code ResultSet} constants:
     *        {@code ResultSet.HOLD_CURSORS_OVER_COMMIT} or {@code ResultSet.CLOSE_CURSORS_AT_COMMIT}.
     * @param statementType The SQL statement type, prepared or callable.
     * @since 2.5.0
     */
    public PStmtKey(final String sql, final String catalog, final String schema, final int resultSetType, final int resultSetConcurrency,
        final int resultSetHoldability, final StatementType statementType) {
<span class="fc" id="L369">        this(sql, catalog, schema, resultSetType, resultSetConcurrency, resultSetHoldability, null, null, null, statementType,</span>
<span class="fc" id="L370">            k -&gt; match(statementType, StatementHoldability, CallHoldability));</span>
<span class="fc" id="L371">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema.
     * @param resultSetType A result set type; one of {@code ResultSet.TYPE_FORWARD_ONLY},
     *        {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or {@code ResultSet.TYPE_SCROLL_SENSITIVE}.
     * @param resultSetConcurrency A concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     *        {@code ResultSet.CONCUR_UPDATABLE}.
     * @param statementType The SQL statement type, prepared or callable.
     * @since 2.5.0
     */
    public PStmtKey(final String sql, final String catalog, final String schema, final int resultSetType, final int resultSetConcurrency,
        final StatementType statementType) {
<span class="fc" id="L388">        this(sql, catalog, schema, resultSetType, resultSetConcurrency, null, null, null, null, statementType,</span>
<span class="fc" id="L389">            k -&gt; match(statementType, StatementConcurrency, CallConcurrency));</span>
<span class="fc" id="L390">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema.
     * @param columnIndexes An array of column indexes indicating the columns that should be returned from the inserted row
     *        or rows.
     */
    public PStmtKey(final String sql, final String catalog, final String schema, final int[] columnIndexes) {
<span class="fc" id="L402">        this(sql, catalog, schema, null, null, null, null, columnIndexes, null, StatementType.PREPARED_STATEMENT, StatementColumnIndexes);</span>
<span class="fc" id="L403">    }</span>

    private PStmtKey(final String sql, final String catalog, final String schema, final Integer resultSetType, final Integer resultSetConcurrency,
        final Integer resultSetHoldability, final Integer autoGeneratedKeys, final int[] columnIndexes, final String[] columnNames,
<span class="fc" id="L407">        final StatementType statementType, final Function&lt;PStmtKey, StatementBuilder&gt; statementBuilder) {</span>
<span class="fc" id="L408">        this.sql = Objects.requireNonNull(sql, &quot;sql&quot;).trim();</span>
<span class="fc" id="L409">        this.catalog = catalog;</span>
<span class="fc" id="L410">        this.schema = schema;</span>
<span class="fc" id="L411">        this.resultSetType = resultSetType;</span>
<span class="fc" id="L412">        this.resultSetConcurrency = resultSetConcurrency;</span>
<span class="fc" id="L413">        this.resultSetHoldability = resultSetHoldability;</span>
<span class="fc" id="L414">        this.autoGeneratedKeys = autoGeneratedKeys;</span>
<span class="fc" id="L415">        this.columnIndexes = clone(columnIndexes);</span>
<span class="fc" id="L416">        this.columnNames = clone(columnNames);</span>
<span class="fc" id="L417">        this.statementBuilder = Objects.requireNonNull(Objects.requireNonNull(statementBuilder, &quot;statementBuilder&quot;).apply(this), &quot;statementBuilder&quot;);</span>
<span class="fc" id="L418">        this.statementType = statementType;</span>
<span class="fc" id="L419">    }</span>

    // Root constructor.
    private PStmtKey(final String sql, final String catalog, final String schema, final Integer resultSetType, final Integer resultSetConcurrency,
        final Integer resultSetHoldability, final Integer autoGeneratedKeys, final int[] columnIndexes, final String[] columnNames,
<span class="fc" id="L424">        final StatementType statementType, final StatementBuilder statementBuilder) {</span>
<span class="fc" id="L425">        this.sql = sql;</span>
<span class="fc" id="L426">        this.catalog = catalog;</span>
<span class="fc" id="L427">        this.schema = schema;</span>
<span class="fc" id="L428">        this.resultSetType = resultSetType;</span>
<span class="fc" id="L429">        this.resultSetConcurrency = resultSetConcurrency;</span>
<span class="fc" id="L430">        this.resultSetHoldability = resultSetHoldability;</span>
<span class="fc" id="L431">        this.autoGeneratedKeys = autoGeneratedKeys;</span>
<span class="fc" id="L432">        this.columnIndexes = clone(columnIndexes);</span>
<span class="fc" id="L433">        this.columnNames = clone(columnNames);</span>
<span class="fc" id="L434">        this.statementBuilder = Objects.requireNonNull(statementBuilder, &quot;statementBuilder&quot;);</span>
<span class="fc" id="L435">        this.statementType = statementType;</span>
<span class="fc" id="L436">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema.
     * @param statementType The SQL statement type, prepared or callable.
     * @since 2.5.0
     */
    public PStmtKey(final String sql, final String catalog, final String schema, final StatementType statementType) {
<span class="fc" id="L448">        this(sql, catalog, schema, null, null, null, null, null, null, statementType, k -&gt; match(statementType, StatementSQL, CallSQL));</span>
<span class="fc" id="L449">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema.
     * @param statementType The SQL statement type, prepared or callable.
     * @param autoGeneratedKeys A flag indicating whether auto-generated keys should be returned; one of
     *        {@code Statement.RETURN_GENERATED_KEYS} or {@code Statement.NO_GENERATED_KEYS}.
     * @since 2.5.0
     */
    public PStmtKey(final String sql, final String catalog, final String schema, final StatementType statementType, final Integer autoGeneratedKeys) {
<span class="fc" id="L463">        this(sql, catalog, schema, null, null, null, autoGeneratedKeys, null, null, statementType,</span>
<span class="fc" id="L464">            k -&gt; match(statementType, StatementAutoGeneratedKeys, CallSQL));</span>
<span class="fc" id="L465">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param schema The schema.
     * @param columnNames An array of column names indicating the columns that should be returned from the inserted row or
     *        rows.
     * @since 2.5.0
     */
    public PStmtKey(final String sql, final String catalog, final String schema, final String[] columnNames) {
<span class="fc" id="L478">        this(sql, catalog, schema, null, null, null, null, null, columnNames, StatementType.PREPARED_STATEMENT, StatementColumnNames);</span>
<span class="fc" id="L479">    }</span>

    /**
     * Constructs a key to uniquely identify a prepared statement.
     *
     * @param sql The SQL statement.
     * @param catalog The catalog.
     * @param columnNames An array of column names indicating the columns that should be returned from the inserted row or
     *        rows.
     * @deprecated Use {@link #PStmtKey(String, String, String, String[])}.
     */
    @Deprecated
    public PStmtKey(final String sql, final String catalog, final String[] columnNames) {
<span class="nc" id="L492">        this(sql, catalog, null, null, null, null, null, null, columnNames, StatementType.PREPARED_STATEMENT, StatementColumnNames);</span>
<span class="nc" id="L493">    }</span>

    private int[] clone(final int[] array) {
<span class="fc bfc" id="L496" title="All 2 branches covered.">        return array == null ? null : array.clone();</span>
    }

    private String[] clone(final String[] array) {
<span class="fc bfc" id="L500" title="All 2 branches covered.">        return array == null ? null : array.clone();</span>
    }

    /**
     * Creates a new Statement from the given Connection.
     *
     * @param connection The Connection to use to create the statement.
     * @return The statement.
     * @throws SQLException Thrown when there is a problem creating the statement.
     */
    public Statement createStatement(final Connection connection) throws SQLException {
<span class="fc" id="L511">        return statementBuilder.createStatement(connection, this);</span>
    }

    @Override
    public boolean equals(final Object obj) {
<span class="fc bfc" id="L516" title="All 2 branches covered.">        if (this == obj) {</span>
<span class="fc" id="L517">            return true;</span>
        }
<span class="pc bpc" id="L519" title="1 of 2 branches missed.">        if (obj == null) {</span>
<span class="nc" id="L520">            return false;</span>
        }
<span class="fc bfc" id="L522" title="All 2 branches covered.">        if (getClass() != obj.getClass()) {</span>
<span class="fc" id="L523">            return false;</span>
        }
<span class="fc" id="L525">        final PStmtKey other = (PStmtKey) obj;</span>
<span class="fc bfc" id="L526" title="All 2 branches covered.">        if (!Objects.equals(autoGeneratedKeys, other.autoGeneratedKeys)) {</span>
<span class="fc" id="L527">            return false;</span>
        }
<span class="fc bfc" id="L529" title="All 2 branches covered.">        if (!Objects.equals(catalog, other.catalog)) {</span>
<span class="fc" id="L530">            return false;</span>
        }
<span class="fc bfc" id="L532" title="All 2 branches covered.">        if (!Arrays.equals(columnIndexes, other.columnIndexes)) {</span>
<span class="fc" id="L533">            return false;</span>
        }
<span class="fc bfc" id="L535" title="All 2 branches covered.">        if (!Arrays.equals(columnNames, other.columnNames)) {</span>
<span class="fc" id="L536">            return false;</span>
        }
<span class="fc bfc" id="L538" title="All 2 branches covered.">        if (!Objects.equals(resultSetConcurrency, other.resultSetConcurrency)) {</span>
<span class="fc" id="L539">            return false;</span>
        }
<span class="fc bfc" id="L541" title="All 2 branches covered.">        if (!Objects.equals(resultSetHoldability, other.resultSetHoldability)) {</span>
<span class="fc" id="L542">            return false;</span>
        }
<span class="fc bfc" id="L544" title="All 2 branches covered.">        if (!Objects.equals(resultSetType, other.resultSetType)) {</span>
<span class="fc" id="L545">            return false;</span>
        }
<span class="fc bfc" id="L547" title="All 2 branches covered.">        if (!Objects.equals(schema, other.schema)) {</span>
<span class="fc" id="L548">            return false;</span>
        }
<span class="fc bfc" id="L550" title="All 2 branches covered.">        if (!Objects.equals(sql, other.sql)) {</span>
<span class="fc" id="L551">            return false;</span>
        }
<span class="fc bfc" id="L553" title="All 2 branches covered.">        return statementType == other.statementType;</span>
    }

    /**
     * Gets a flag indicating whether auto-generated keys should be returned; one of {@code Statement.RETURN_GENERATED_KEYS}
     * or {@code Statement.NO_GENERATED_KEYS}.
     *
     * @return a flag indicating whether auto-generated keys should be returned.
     */
    public Integer getAutoGeneratedKeys() {
<span class="fc" id="L563">        return autoGeneratedKeys;</span>
    }

    /**
     * Gets the catalog.
     *
     * @return The catalog.
     */
    public String getCatalog() {
<span class="fc" id="L572">        return catalog;</span>
    }

    /**
     * Gets an array of column indexes indicating the columns that should be returned from the inserted row or rows.
     *
     * @return An array of column indexes.
     */
    public int[] getColumnIndexes() {
<span class="fc" id="L581">        return clone(columnIndexes);</span>
    }

    /**
     * Gets an array of column names indicating the columns that should be returned from the inserted row or rows.
     *
     * @return An array of column names.
     */
    public String[] getColumnNames() {
<span class="fc" id="L590">        return clone(columnNames);</span>
    }

    /**
     * Gets the result set concurrency type; one of {@code ResultSet.CONCUR_READ_ONLY} or
     * {@code ResultSet.CONCUR_UPDATABLE}.
     *
     * @return The result set concurrency type.
     */
    public Integer getResultSetConcurrency() {
<span class="fc" id="L600">        return resultSetConcurrency;</span>
    }

    /**
     * Gets the result set holdability, one of the following {@code ResultSet} constants:
     * {@code ResultSet.HOLD_CURSORS_OVER_COMMIT} or {@code ResultSet.CLOSE_CURSORS_AT_COMMIT}.
     *
     * @return The result set holdability.
     */
    public Integer getResultSetHoldability() {
<span class="fc" id="L610">        return resultSetHoldability;</span>
    }

    /**
     * Gets the result set type, one of {@code ResultSet.TYPE_FORWARD_ONLY}, {@code ResultSet.TYPE_SCROLL_INSENSITIVE}, or
     * {@code ResultSet.TYPE_SCROLL_SENSITIVE}.
     *
     * @return the result set type.
     */
    public Integer getResultSetType() {
<span class="fc" id="L620">        return resultSetType;</span>
    }

    /**
     * Gets the schema.
     *
     * @return The catalog.
     */
    public String getSchema() {
<span class="fc" id="L629">        return schema;</span>
    }

    /**
     * Gets the SQL statement.
     *
     * @return the SQL statement.
     */
    public String getSql() {
<span class="fc" id="L638">        return sql;</span>
    }

    /**
     * Gets the SQL statement type.
     *
     * @return The SQL statement type.
     */
    public StatementType getStmtType() {
<span class="fc" id="L647">        return statementType;</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L652">        return Objects.hash(autoGeneratedKeys, catalog, Arrays.hashCode(columnIndexes), Arrays.hashCode(columnNames), resultSetConcurrency,</span>
            resultSetHoldability, resultSetType, schema, sql, statementType);
    }

    @Override
    public String toString() {
<span class="fc" id="L658">        final StringBuilder buf = new StringBuilder();</span>
<span class="fc" id="L659">        buf.append(&quot;PStmtKey: sql=&quot;);</span>
<span class="fc" id="L660">        buf.append(sql);</span>
<span class="fc" id="L661">        buf.append(&quot;, catalog=&quot;);</span>
<span class="fc" id="L662">        buf.append(catalog);</span>
<span class="fc" id="L663">        buf.append(&quot;, schema=&quot;);</span>
<span class="fc" id="L664">        buf.append(schema);</span>
<span class="fc" id="L665">        buf.append(&quot;, resultSetType=&quot;);</span>
<span class="fc" id="L666">        buf.append(resultSetType);</span>
<span class="fc" id="L667">        buf.append(&quot;, resultSetConcurrency=&quot;);</span>
<span class="fc" id="L668">        buf.append(resultSetConcurrency);</span>
<span class="fc" id="L669">        buf.append(&quot;, resultSetHoldability=&quot;);</span>
<span class="fc" id="L670">        buf.append(resultSetHoldability);</span>
<span class="fc" id="L671">        buf.append(&quot;, autoGeneratedKeys=&quot;);</span>
<span class="fc" id="L672">        buf.append(autoGeneratedKeys);</span>
<span class="fc" id="L673">        buf.append(&quot;, columnIndexes=&quot;);</span>
<span class="fc" id="L674">        buf.append(Arrays.toString(columnIndexes));</span>
<span class="fc" id="L675">        buf.append(&quot;, columnNames=&quot;);</span>
<span class="fc" id="L676">        buf.append(Arrays.toString(columnNames));</span>
<span class="fc" id="L677">        buf.append(&quot;, statementType=&quot;);</span>
<span class="fc" id="L678">        buf.append(statementType);</span>
<span class="fc" id="L679">        return buf.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>